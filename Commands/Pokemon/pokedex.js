const { mkpokemon } = require("../../Database/dataschema.js");

module.exports = {
    name: "pokedex",
    alias: ["pokedeck"],
    desc: "View your caught PokÃ©mon collection",
    category: "Pokemon",
    usage: "pokedex",
    react: "ğŸ",
    start: async (Miku, m, { prefix, pushName }) => {
        
        // 1. Fetch User's Pokemon (Seedha database se)
        const userPoke = await mkpokemon.find({ owner: m.sender });

        // 2. Check Empty
        if (!userPoke || userPoke.length === 0) {
            let buttons = [
                { buttonId: `${prefix}pokestart`, buttonText: { displayText: "ğŸ—ï¸ Start Journey" }, type: 1 }
            ];
            return Miku.sendButtonText(m.from, buttons, `ğŸ€ *Your Pokedex is Empty!* \n\nYou haven't caught any PokÃ©mon yet.\nUse *${prefix}pokestart* or *${prefix}hunt* to begin!`, `*${global.botName}*`, m);
        }

        // 3. Sorting Logic (Strongest / High Level first)
        userPoke.sort((a, b) => b.level - a.level);

        // 4. Generate List Text
        let msg = `ã€½ï¸ *${pushName}'s Pokedex* \n` +
                  `ğŸ® *Total Caught:* ${userPoke.length}\n` +
                  `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;

        // Display Limit (Top 20 dikhayenge taaki message lamba na ho)
        const displayLimit = 20;
        
        userPoke.slice(0, displayLimit).forEach((p, i) => {
            const shinyIcon = p.shiny ? "âœ¨ " : ""; // Shiny hai to star dikhao
            const nickname = p.nickname ? `_(${p.nickname})_` : ""; // Nickname agar hai
            
            msg += `*${i + 1}.* ${shinyIcon}*${p.name}* ${nickname} [Lvl ${p.level}]\n`;
        });

        if (userPoke.length > displayLimit) {
            msg += `\n...and *${userPoke.length - displayLimit}* more waiting in PC.`;
        }

        msg += `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n` +
               `ğŸ’¡ *Tip:* Use *${prefix}pokeinfo <name>* to check stats or *${prefix}setmain <name>* to equip!`;

        // 5. Buttons
        let buttons = [
            { buttonId: `${prefix}hunt`, buttonText: { displayText: "ğŸ” Hunt More" }, type: 1 }
        ];


        await Miku.sendMessage(m.from, {
            image: {url : botImage5} ,
            caption: msg,
            footer: `*${global.botName} Pokedex*`,
            buttons: buttons,
            type: 4
        }, { quoted: m });
    }
};